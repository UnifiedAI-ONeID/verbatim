# Deploying Verbatim to the App Stores via PWABuilder

This guide explains how to generate Android and iOS store packages for Verbatim with the PWABuilder CLI/Plugin and what to do with the artifacts afterwards.

## 1. Prerequisites
- Deploy the production build of Verbatim to a HTTPS origin (for example, your Firebase Hosting URL). The manifest must be reachable at `https://<your-domain>/manifest.json`. The current manifest lives at `manifest.json` and already includes screenshots, icons, and maskable assets required by PWABuilder.
- Verify that the service worker (`sw.js`) is served from the origin root. PWABuilder checks for an offline-capable service worker before creating store-ready packages.
- Install the project dependencies and build output once locally:  
  ```bash
  npm install
  npm run build
  ```
- (Optional but recommended) Install the PWABuilder CLI locally so you get reproducible results without the global download every run:  
  ```bash
  npm install --save-dev @pwabuilder/cli
  ```
  You can also use `npx @pwabuilder/cli` if you prefer not to add a dev dependency.

## 2. Package Generation Commands
Run the following from the repository root after each production deployment. Replace the placeholder values with your actual production domain, Android package id, and iOS bundle id.

```bash
# Android (generates an Android App Bundle project)
npx @pwabuilder/cli package \
  --platform android \
  --base-url https://<your-domain> \
  --manifest ./dist/manifest.webmanifest \
  --android-package-id com.verbatim.app \
  --name "Verbatim" \
  --short-name "Verbatim" \
  --out ./pwabuilder/android

# iOS (generates an Xcode project ready for App Store Connect)
npx @pwabuilder/cli package \
  --platform ios \
  --base-url https://<your-domain> \
  --manifest ./dist/manifest.webmanifest \
  --ios-bundle-id com.verbatim.app \
  --name "Verbatim" \
  --short-name "Verbatim" \
  --out ./pwabuilder/ios
```

Key flags:
- `--base-url` must match the exact production origin that serves `manifest.json`.
- `--manifest` should point at the built manifest inside `dist`. Vite copies `manifest.json` to `dist/manifest.webmanifest` during `npm run build`.
- `--android-package-id` and `--ios-bundle-id` must be unique in their respective stores. PWABuilder will reject invalid identifiers.
- `--out` controls where PWABuilder writes the packaged projects; storing them under `pwabuilder/` keeps the repo organized.

> Tip: If you install the CLI as a dev dependency, add an npm script such as `pwabuilder:android` or `pwabuilder:ios` to streamline the command for teammates.

## 3. Android Play Store Deployment
1. Open the generated folder `./pwabuilder/android`. PWABuilder outputs a ZIP containing:
   - An Android Studio project (for a Trusted Web Activity).
   - A README with signing and upload instructions.
   - A `.well-known/assetlinks.json` file.
2. Create or reuse an Android signing key. Update the `signingConfig` section in the generated project, or follow the README to inject your keystore when running `./gradlew bundleRelease`.
3. Upload the resulting `.aab` file to Google Play Console > **Production** > **Create new release**.
4. Deploy `assetlinks.json` to `https://<your-domain>/.well-known/assetlinks.json` (Firebase Hosting: add the file under `public/.well-known/`). Without it, Play Store install verification will fail.
5. Complete listing metadata, screenshots (the manifest screenshots in `public/screenshots/` match the recommended sizes), privacy policy, and submit for review.

## 4. iOS App Store Deployment
1. Open `./pwabuilder/ios/` in Xcode. The CLI generates a TWA-based wrapper targeting WKWebView.
2. In Xcode:
   - Update the bundle identifier to match the `--ios-bundle-id` you chose.
   - Set your signing team under **Signing & Capabilities**.
   - Verify the app name, icons (PWABuilder copies the ones from `manifest.json`), and launch screen assets.
3. Build an archive (`Product > Archive`) and upload it via the Organizer to App Store Connect.
4. Add the Apple App Site Association file generated by PWABuilder (`apple-app-site-association`) to `https://<your-domain>/.well-known/`. This enables universal linking and meets App Store review requirements.
5. Finish the App Store Connect listing (metadata, age rating, privacy, etc.) and submit the build for review.

## 5. Validation Checklist Before Each Submission
- Rebuild the PWA (`npm run build`) after any UI or manifest change; confirm `dist/manifest.webmanifest` has the updated metadata.
- Load the production URL on-device and confirm the install prompt and offline caching still work (validates `sw.js`).
- Confirm all external endpoints referenced in `Content-Security-Policy` (see `firebase.json`) are still accurate; Trusted Web Activity uses this for verification.
- Update store screenshots if the UI changed significantly. Source assets live in `public/screenshots/`.

Following this flow keeps the PWA metadata in sync with the store packages and relies on PWABuilderâ€™s plugin tooling for the heavy lifting. Commit the output folders only if you need them versioned; otherwise, add them to `.gitignore`.
